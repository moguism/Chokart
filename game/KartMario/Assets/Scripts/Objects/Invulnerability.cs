using System.Linq;
using Unity.Netcode;
using UnityEngine;

public class Invulnerability : BasicObject
{
    public KartController parent;
    public PositionManager positionManager;

    [SerializeField]
    private float boostTimer;

    void Update()
    {
        if (parent != null)
        {
            boostTimer -= Time.deltaTime;
            parent.canBeHurt = false;

            if (boostTimer <= 0.0f)
            {
                parent.canBeHurt = true;

                if (IsOwner)
                {
                    NotifyInvulnerabilityServerRpc(owner, parent.canBeHurt);
                    DespawnOnTimeServerRpc();
                }
            }

            NotifyInvulnerabilityServerRpc(owner, parent.canBeHurt);
        }
    }

    [ServerRpc]
    private void NotifyInvulnerabilityServerRpc(ulong kartId, bool canBeHurt)
    {
        KartController kart = positionManager.karts.FirstOrDefault(k => k.NetworkObjectId == kartId);
        kart.canBeHurt = canBeHurt;
    }

    public new void UseObject()
    {
        print("Usada invulnerabilidad");
    }
}
